<style>
.green {
	color: green;
}

.red {
	color: red;
}

.white {
	color: white;
}

.sticky {
	position: -webkit-sticky;
	position: -moz-sticky;
	position: -ms-sticky;
	position: -o-sticky;
	position: sticky;
	top: 0px;
}

#pick-channel-btn {
	position: absolute;
	left: 15px;
	bottom: 0;
}
.select-btns {
	position: absolute;
	right: 15px;
}
</style>
<div class="container-fluid">
	<div class="row">
		<div class="col-md-2" style="position: relative;">
			<button id="pick-channel-btn" class="btn btn-block btn-outline-primary" on:click='set({ channelPickMode: !channelPickMode })'>{{#if channelPickMode}}Done{{else}}Pick Channels{{/if}}</button>
		</div>
		<div class="col-md-8">
			<h1 class="display-4 text-center" style="margin-bottom: 15px;">
				Way <a style="color: inherit" href="https://en.wikipedia.org/wiki/Over-the-top_content" target="_blank">Over the Top</a>
			</h1>
		</div>
		<div class="col-md-2" style="position: relative;">
		{{#if channelPickMode}}
			<button class="btn btn-block btn-outline-primary select-btns" style="bottom: 1;" on:click="showAllChannels(true)">Select All</button>
			<button class="btn btn-block btn-outline-primary select-btns" style="bottom: 0;" on:click="showAllChannels(false)">Select None</button>
		{{/if}}
		</div>
	</div>
	{{#if channelPickMode}}
	<ChannelSelector channels="{{channelLineup}}" bind:shown />
	{{else}}
	<ChannelList channels="{{visibleChannels}}" />
	{{/if}}
</div>
<script>
import channelLineup from './data/provider-channels.js'
import ChannelList from './ChannelList.html'
import ChannelSelector from './ChannelSelector.html'

export default {
	data() {
		const shown = {}

		channelLineup.forEach(channel => {
			shown[channel.Name] = true
		})

		const localStorageShownChannels = localStorage.getItem('shownChannels')
		if(localStorageShownChannels) {
			Object.assign(shown, JSON.parse(localStorageShownChannels))
		}
		
		return {
			channelLineup,
			shown
		}
	},
	computed: {
		visibleChannels: (channelLineup, shown) => {
			return channelLineup.filter(channel => shown[channel.Name])
		}
	},
	components: {
		ChannelSelector,
		ChannelList
	},
	methods: {
		showAllChannels(show) {
			const shown = this.get('shown')
			Object.keys(shown).forEach(function(channel) {
			    shown[channel] = show
			});

			this.set({ shown })
			if(show) localStorage.removeItem('shownChannels')
			else localStorage.setItem('shownChannels', JSON.stringify(shown))
			
		}
	}
}
</script>
